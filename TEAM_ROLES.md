# 团队分工与职责说明书

本文档详细界定了“心境 (Flow State)”项目 6 人团队的角色分配、职责范围及模块归属。

---

## 1. 团队角色概览

| 角色 | 人数 | 核心职责 | 关键词 |
| :--- | :---: | :--- | :--- |
| **产品体验官 ** | 1 | 需求分析、质量验收| 方向、验收 |
| **TPM (架构师/集成)** | 1 | 架构设计、核心胶水代码、DevOps、IPC 通信、进度管理  | 架构、兜底 |
| **AI 算法工程师** | 2 | 视觉算法、OCR、状态判定模型、AI Worker 进程 | 智能、识别 |
| **后端/数据工程师** | 2 | 数据库设计、数据统计、Web 后端 (Flask) | 存储、统计 |
| **前端/UI 工程师** | 1 | 桌面端 (PyQt) 交互与视觉、Web 前端 (Vue) | 交互、颜值 |

---

## 2. 详细职责与模块分配

### 2.1 TPM (架构师/集成 - 你)
*   **职责**:
    *   **顶层设计**: 维护 `PROJECT_STRUCTURE.md` 和 `PROMPT.txt`，制定跨进程通信 (IPC) 协议和全局数据格式。
    *   **流程调度**: 负责 `run.py` 的多进程管理，确保 AI 生产数据、Web 托管数据、UI 消费数据的闭环畅通。
    *   **系统稳定性**: 监控子进程健康状况，通过“调试暗号”进行快速故障定位。
    *   **环境构建**: 负责依赖管理、PyInstaller 打包发布及 CI/CD 流程。
*   **核心模块**:
    *   `run.py`: 进程指挥中心。
    *   `app/core/`: 全局配置与基础设施。
    *   `PROMPT.txt`: 架构契约文档。

### 2.2 AI 算法工程师 (2人)
*   **AI A (视觉计算)**:
    *   **职责**: 优化 `vision.py` 中的人脸/视线检测算法，提高疲劳与专注度判定的准确率。
    *   **模块**: `app/services/ai/vision.py`
*   **AI B (Worker 与 OCR)**:
    *   **职责**: 维护 `ai_worker.py` 独立进程，实现屏幕内容 OCR 识别，并负责对接 LLM 生成智能点评。
    *   **模块**: `app/services/ai_worker.py`, `app/services/reminder/generator.py`
*   **共同产出**: 负责将实时状态通过 `msg_queue` 推送给主进程。

### 2.3 后端/数据工程师 (2人)
*   **后端 A (Web Server)**:
    *   **职责**: 负责 `web_server.py` 的 API 开发，为网页端提供历史记录查询、AI 报告生成等 RESTful 接口。
    *   **模块**: `app/services/web_server.py`
*   **后端 B (Data Layer)**:
    *   **职责**: 负责高度模块化的 `app/data` 目录。设计数据库表结构，编写高效的 DAO 层代码，实现数据的持久化与清理策略。
    *   **模块**: `app/data/` (DAO, Core, Services)
*   **共同产出**: 确保数据的准确存储与高效检索，严禁在 Web 进程中写入实时状态。

### 2.4 前端/UI 工程师 (1人)
*   **职责 (桌面端)**:
    *   负责 PyQt 悬浮球及弹窗的交互逻辑。通过定时器监听 `msg_queue`，实现 UI 状态的实时更新。
    *   **模块**: `app/ui/`
*   **职责 (网页端)**:
    *   负责 `app/web/` 下的 Vue 仪表盘开发。实现日历导航、时间轴可视化及 AI 助手聊天界面。
    *   **模块**: `app/web/`
*   **核心挑战**: 维护桌面端与网页端视觉语言的高度统一。

---

## 3. 关键跨部门协作流程

### 3.1 实时数据闭环 (从采集到展示)
1.  **AI 工程师**: 在 `ai_worker` 进程中分析摄像头数据，产生 `status` 对象，调用 `ActivityHistoryManager` 写入数据库，并 `put` 到 `msg_queue`。
2.  **架构师**: 确保 `run.py` 开启了正确的通信通道。
3.  **UI 工程师**: 主进程轮询 `msg_queue`，拿到数据后立即更新悬浮球颜色。

### 3.2 历史报表与 AI 生成 (从存储到网页)
1.  **产品经理**: 确定报表所需的维度（如：专注效率分布）。
2.  **后端工程师 (B)**: 在 `StatsDAO` 中实现聚合统计查询。
3.  **后端工程师 (A)**: 在 `web_server.py` 中暴露 `/api/history` 接口。
4.  **UI 工程师**: 在 Vue 页面调用接口，使用图表库展示数据。
5.  **AI 工程师 (B)**: 提供 `POST /api/generate_report` 接口，结合后端查询到的数据，调用大模型生成文本总结。

### 3.3 系统退出与资源清理
1.  **架构师**: 在 `run.py` 捕获退出信号，设置 `running_event.clear()`。
2.  **AI 工程师**: 在 `ai_worker` 中检测到事件后，优雅关闭摄像头并退出。
3.  **后端工程师**: 确保 Web 进程被 `terminate()`，数据库连接安全关闭。
4.  **UI 工程师**: 销毁所有 PyQt 窗口。
